var signer = require("../pkixtsp");
var cutil = require("../convertutil");
var rs = require('jsrsasign');
var asn = require("asn1");

exports["test create query"] = function(assert) {
	var hash = [0xf0, 0x19, 0xba, 0xa4, 0x9d, 0x02, 0x79, 0xfb, 0xfa, 0x91, 0x03, 0x2f, 0x63, 0x5b, 0xa5, 0x00, 0x77, 0xb8, 0xcd, 0x1d];
	var actual = signer._createQuery(hash);
	var expected = "30260201013021300906052b0e03021a05000414f019baa49d0279fbfa91032f635ba50077b8cd1d";

	assert.equal(expected, util.arrayToHex(actual), "request string is the same");
};

exports["test parse self signed"] = function(assert){
	var resp = cutil.hexToArray("3082038a06092a864886f70d010702a082037b30820377020101310b300906052b0e03021a0500300b06092a864886f70d010701a082025c30820258308201c1a003020102020900e1ce6b6269d3bd11300d06092a864886f70d01010b05003045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c7464301e170d3136303431363038303131375a170d3136303531363038303131375a3045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100af238f8704f8a48e9032189be8cc1f2218b54971b66e2b731d481c951dabcc46f583597854761849acaa052b95783affb2725205f03eaf1d48eba0e34f0d2a1d3b08293045e5a5d8d69ddaa3a88345b458d6abaf1199b210e733db4023e55e96329f66cbcac145a8eacae056e3ad32ef252699dcf9c12ab7d8aa8da0a4120dc70203010001a350304e301d0603551d0e0416041409d906233d60981953a530b2568c840bf84512a8301f0603551d2304183016801409d906233d60981953a530b2568c840bf84512a8300c0603551d13040530030101ff300d06092a864886f70d01010b05000381810009ec8e2547f0cee04be53737c710e0deadf9485ee2f09572502e2c0695e38001518f6f0a780ce13ba6218ec94bb6bab349b70bb6a3d53dc66e524c4e734e9201b9b5554f26679af9c8219b1c4d99ab4ac0673163afbf6dc38fdd05cbffbc775bf1ebdad20269f1cf746d6accc74a9db11eadeee7354e25cd6e66503ef4e3e1b13181f73081f402010130523045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c7464020900e1ce6b6269d3bd11300906052b0e03021a0500300d06092a864886f70d010101050004818004bd3fa2a2bb23d227bac2ee68bbe76b0afc9ca7de652af749c5ccdcdafbd40c446b85adc58e298ed7f42bd0d489af40fe9a7400ae7c5555f1885bd8963ddbe28548978529431efeadcc85d9e85d5dece36437270ad44040168f9040754293c76f80b35d2cff75f24751b4c27c4de97f8ccaedf1206c4aedc7673ef5332230da");
	var asn1 = asn.decodeDER(resp, 0, {});
	var obj = signer._parseTimestampToken(asn1);
	console.log(JSON.stringify(obj, null, 2));
};

exports["test parse"] = function(assert){
	var resp = cutil.hexToArray("308207da301502010030100c0e4f7065726174696f6e204f6b6179308207bf06092a864886f70d010702a08207b0308207ac020103310b300906052b0e03021a0500306e060b2a864886f70d0109100104a05f045d305b020101060c2b0601040181ad21822c16013021300906052b0e03021a0500041455b064d66646d75c106b8ff34f528e98334472f002147189030d4289090d87a56a7cd60ffd56fb3e0680180f32303136303431333130343934325aa08205113082050d308203f5a0030201020204123f9f43300d06092a864886f70d01010505003055310b300906035504061302444531133011060355040a130a44464e2d56657265696e3110300e060355040b130744464e2d504b49311f301d0603550403131644464e2d56657265696e204341205365727669636573301e170d3131303731353131313730375a170d3136303731333131313730375a304e310b300906035504061302444531133011060355040a130a44464e2d56657265696e3110300e060355040b130744464e2d504b49311830160603550403130f504e3a205a6569747374656d70656c30820122300d06092a864886f70d01010105000382010f003082010a0282010100a9ac33b296da7177999d464f47aa4a40d57d58dcfd93beae68913ab75cb77fe36c4b52b3b55a53cce10f70880a81aba4ffdc1d4826fe645cbabcd1e0b4eceff702f6fb378670128eadbe39a4a9e484c1d01f95fcfcbd44ca091dcc344e0356ca8967f54f7f6acc0dd5af8c1a4f77003fe01c3b98d6611d52b3fe432962544e142cc6f99163ccb7798bb8d4aea948d0cd6f72b740915b87ca2824ac9ec958ab0e5eacb36a7a66be091e826f862849026aa911e3b1a84487f6654aad7f3be4d1d9d312b2f9fcd7c69836ae893060393a47b310a6a4b03eeea6c8659df57782fa75855007d5ffb622ff8d229edd57c0771149b7fc827780fcde0c02f82bc2977d250203010001a38201ea308201e630090603551d1304023000300b0603551d0f0404030206c030160603551d250101ff040c300a06082b06010505070308301d0603551d0e04160414ec88dc78663109b4892d7ddb1b9cacd80642aed9301f0603551d230418301680141da9f18626764dcf5dfd50a36eebf1bc22756deb3081910603551d1f0481893081863041a03fa03d863b687474703a2f2f636470312e7063612e64666e2e64652f676c6f62616c2d73657276696365732d63612f7075622f63726c2f636163726c2e63726c3041a03fa03d863b687474703a2f2f636470322e7063612e64666e2e64652f676c6f62616c2d73657276696365732d63612f7075622f63726c2f636163726c2e63726c3081df06082b060105050701010481d23081cf303306082b060105050730018627687474703a2f2f6f6373702e7063612e64666e2e64652f4f4353502d5365727665722f4f435350304b06082b06010505073002863f687474703a2f2f636470312e7063612e64666e2e64652f676c6f62616c2d73657276696365732d63612f7075622f6361636572742f6361636572742e637274304b06082b06010505073002863f687474703a2f2f636470322e7063612e64666e2e64652f676c6f62616c2d73657276696365732d63612f7075622f6361636572742f6361636572742e637274300d06092a864886f70d0101050500038201010015ef8c64be9f746166745ce0ffb655139cd47a298d433da445781dbbf960ded26a0c0fee0b6c009f613135c1a8c8cb60e5e9246b4c0fb695e1615dd2f63e0c61ae13b0f8590955bb0a2c4401536af5f8a400876007a9f475fd68b8b2dc48e82e981fd6d0a976cd7e53537611144bedcebc53b6b8ff92c723fd3e7f091daaa63a9bd78aaac035eb36a0d73a8a02b41255ff7c4ceb369c97127d3ae4163803e088158a6a53851e351c7c45bf920dce6f9ba460bcd6e386a958905dd12b6beb7f0f139885302575546e3cd96bdcf213d3449e2b9e534307b42c4b4e19507f3accb7a61ea87946321bbf0f0c0c54f452d36d9c36edac6deb9db0f34476e3ce43578e318202133082020f020101305d3055310b300906035504061302444531133011060355040a130a44464e2d56657265696e3110300e060355040b130744464e2d504b49311f301d0603550403131644464e2d56657265696e2043412053657276696365730204123f9f43300906052b0e03021a0500a0818c301a06092a864886f70d010903310d060b2a864886f70d0109100104301c06092a864886f70d010905310f170d3136303431333130343934325a302306092a864886f70d01090431160414774157041e0eb4b538d67b0b64ce69fe91e0e230302b060b2a864886f70d010910020c311c301a30183016041443671ce7e61beec089528ed1f20a2c3c92cd40a2300d06092a864886f70d0101010500048201000a65be649e97bc8a05e50c73cc17d1de73c6e3e4051f8aa2f377e35c425e7071e50e9d0c3db6f79fd2b1461e085f39cf67fbb91858cf9fab8c0d4ad311a20cea84d6135657e61505779ab167399968eba05fd5559000d1a7b877075024b8a79b06755d710de271af195cf55800f9ea37f855f618cbcc352b5bc062a476e20554413db4b09ed27af3a1cc1e51f1e5b52cfc0806ce9600ae1a84599f60d2beda429793c65991e02149d4a2fd7cb6a2ae47a4faec89940aabceefc675933df4d68170909bef8fb3f25d18df34da35c0aaf2b2014b3ed457c405a4226824e5640552284078b788734202226cfd482323036679dd6f57db92f90eb3b58f1a6a751473");
	var obj = signer._parse(resp);
	console.log(JSON.stringify(obj, null, 2));
};

require("sdk/test").run(exports);