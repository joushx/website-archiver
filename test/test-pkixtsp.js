var pkixtsp = require("../pkixtsp");
var cutil = require("../convertutil");
var asn = require("asn1");

exports["test create query"] = function(assert) {
	var hash = "043a718774c572bd8a25adbeb1bfcd5c0256ae11cecf9f9c3f925d0e52beaf89";
	var actual = pkixtsp._createQuery(hash, "a0bf6018d1023a45aa25");
	var expected = "30450201013031300d060960864801650304020105000420043a718774c572bd8a25adbeb1bfcd5c0256ae11cecf9f9c3f925d0e52beaf89020aa0bf6018d1023a45aa250101ff";

	assert.equal(expected, actual, "request string is the same");
};

exports["test parse cert"] = function(assert){
	var resp = cutil.hexToArray("3082038a06092a864886f70d010702a082037b30820377020101310b300906052b0e03021a0500300b06092a864886f70d010701a082025c30820258308201c1a003020102020900e1ce6b6269d3bd11300d06092a864886f70d01010b05003045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c7464301e170d3136303431363038303131375a170d3136303531363038303131375a3045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100af238f8704f8a48e9032189be8cc1f2218b54971b66e2b731d481c951dabcc46f583597854761849acaa052b95783affb2725205f03eaf1d48eba0e34f0d2a1d3b08293045e5a5d8d69ddaa3a88345b458d6abaf1199b210e733db4023e55e96329f66cbcac145a8eacae056e3ad32ef252699dcf9c12ab7d8aa8da0a4120dc70203010001a350304e301d0603551d0e0416041409d906233d60981953a530b2568c840bf84512a8301f0603551d2304183016801409d906233d60981953a530b2568c840bf84512a8300c0603551d13040530030101ff300d06092a864886f70d01010b05000381810009ec8e2547f0cee04be53737c710e0deadf9485ee2f09572502e2c0695e38001518f6f0a780ce13ba6218ec94bb6bab349b70bb6a3d53dc66e524c4e734e9201b9b5554f26679af9c8219b1c4d99ab4ac0673163afbf6dc38fdd05cbffbc775bf1ebdad20269f1cf746d6accc74a9db11eadeee7354e25cd6e66503ef4e3e1b13181f73081f402010130523045310b30090603550406130241543113301106035504080c0a536f6d652d53746174653121301f060355040a0c18496e7465726e6574205769646769747320507479204c7464020900e1ce6b6269d3bd11300906052b0e03021a0500300d06092a864886f70d010101050004818004bd3fa2a2bb23d227bac2ee68bbe76b0afc9ca7de652af749c5ccdcdafbd40c446b85adc58e298ed7f42bd0d489af40fe9a7400ae7c5555f1885bd8963ddbe28548978529431efeadcc85d9e85d5dece36437270ad44040168f9040754293c76f80b35d2cff75f24751b4c27c4de97f8ccaedf1206c4aedc7673ef5332230da");
	var asn1 = asn.decodeDER(resp, 0, {});
	var obj = pkixtsp._parseTimestampToken(asn1);

	assert.equal(obj.contentType, "1.2.840.113549.1.7.2", "content type");
	assert.equal(obj.signedData.certificates[0].subjectPublicKeyInfo, "30819f300d06092a864886f70d010101050003818d0030818902818100af238f8704f8a48e9032189be8cc1f2218b54971b66e2b731d481c951dabcc46f583597854761849acaa052b95783affb2725205f03eaf1d48eba0e34f0d2a1d3b08293045e5a5d8d69ddaa3a88345b458d6abaf1199b210e733db4023e55e96329f66cbcac145a8eacae056e3ad32ef252699dcf9c12ab7d8aa8da0a4120dc70203010001", "spki");
};

require("sdk/test").run(exports);